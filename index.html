<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="ZXing for JS">
    <title>ZXing TypeScript | è§£ç ç¤ºä¾‹</title>
    <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null" href="https://unpkg.com/normalize.css@8.0.0/normalize.css">
    <link rel="stylesheet" rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null" href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css">
</head>
<body>
    <main class="wrapper" style="padding-top:2em">
        <section class="container" id="demo-content">
            <h1 class="title">ä»æœ¬åœ°å›¾åƒæˆ–æ‘„åƒå¤´æ‰«æä¸€ç»´/äºŒç»´ç </h1>
            <p>
                <a class="button-small button-outline" href="../../index.html">é¦–é¡µ ğŸ¡</a>
            </p>
            <p>æ­¤ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ZXing JavaScriptåº“ä»æœ¬åœ°å›¾åƒæ–‡ä»¶æˆ–æ‘„åƒå¤´æµæ‰«æä»»ä½•æ”¯æŒçš„ä¸€ç»´/äºŒç»´ç ã€‚</p>
            
            <!-- ä»æœ¬åœ°å›¾åƒè§£ç  -->
            <div>
                <h2>ä»æœ¬åœ°å›¾åƒè§£ç </h2>
                <input type="file" id="imageFileInput" accept="image/*">
                <a class="button" id="decodeButton">è§£ç </a>
                <div id="imagePreview">
                    <!-- è¿™é‡Œå°†åŠ¨æ€æ˜¾ç¤ºé€‰æ‹©çš„å›¾åƒ -->
                </div>
                <label>ç»“æœ:</label>
                <pre><code id="resultImage"></code></pre>
            </div>
            
            <!-- ä»æ‘„åƒå¤´æµè§£ç  -->
            <div>
                <h2>ä»æ‘„åƒå¤´æµè§£ç </h2>
                <div>
                    <a class="button" id="startButton">å¼€å§‹</a>
                    <a class="button" id="resetButton">é‡ç½®</a>
                </div>
                <div>
                    <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
                </div>
                <div id="sourceSelectPanel" style="display:none">
                    <label for="sourceSelect">æ›´æ”¹è§†é¢‘æº:</label>
                    <select id="sourceSelect" style="max-width:400px"></select>
                </div>
                <label>ç»“æœ:ï¼ˆåªè¦æ‰“å¼€æ‘„åƒå¤´ï¼Œæ£€æµ‹åˆ°å°±ä¼šç›´æ¥æ˜¾ç¤ºé“¾æ¥ï¼Œä¸éœ€è¦å…¶ä»–æ“ä½œï¼‰ï¼Œæ£€æµ‹åˆ°å¦å¤–ä¸€ä¸ªäºŒç»´ç ï¼Œä¹Ÿä¼šç›´æ¥åˆ‡æ¢é“¾æ¥æ˜¾ç¤º</label>
                <pre><code id="resultCamera"></code></pre>
            </div>
            
            <p>æŸ¥çœ‹æ­¤ç¤ºä¾‹çš„ <a href="https://github.com/zxing-js/library/tree/master/docs/examples/multi-image/">æºä»£ç </a>.</p>
        </section>
        <footer class="footer">
            <section class="container">
                <p>ZXing TypeScriptæ¼”ç¤ºã€‚éµå¾ª <a target="_blank" href="https://github.com/zxing-js/library#license" title="MIT">MITè®¸å¯åè®®</a>ã€‚</p>
            </section>
        </footer>
    </main>
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
    <script type="text/javascript">
        window.addEventListener('load', function () {
            const codeReader = new ZXing.BrowserMultiFormatReader();
            console.log('ZXing ä»£ç è¯»å–å™¨å·²åˆå§‹åŒ–');

            // ä»æœ¬åœ°å›¾åƒè§£ç 
            document.getElementById('decodeButton').addEventListener('click', () => {
                const fileInput = document.getElementById('imageFileInput');
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const img = new Image();
                        img.src = reader.result;
                        img.onload = () => {
                            codeReader.decodeFromImage(img).then((result) => {
                                console.log(result);
                                document.getElementById('resultImage').textContent = result.text;
                            }).catch((err) => {
                                console.error(err);
                                document.getElementById('resultImage').textContent = err;
                            });
                            console.log(`å¼€å§‹è§£ç æ¥è‡ª ${file.name} çš„å›¾åƒ`);
                            // æ˜¾ç¤ºå›¾åƒé¢„è§ˆ
                            const imagePreview = document.getElementById('imagePreview');
                            imagePreview.innerHTML = `<img src="${reader.result}" style="border: 1px solid gray">`;
                        };
                    };
                    reader.readAsDataURL(file);
                } else {
                    console.error('è¯·é€‰æ‹©ä¸€ä¸ªå›¾åƒæ–‡ä»¶');
                }
            });

            // ä»æ‘„åƒå¤´æµè§£ç 
            let selectedDeviceId;
            codeReader.listVideoInputDevices()
                .then((videoInputDevices) => {
                    const sourceSelect = document.getElementById('sourceSelect');
                    selectedDeviceId = videoInputDevices[0].deviceId;
                    if (videoInputDevices.length >= 1) {
                        videoInputDevices.forEach((element) => {
                            const sourceOption = document.createElement('option');
                            sourceOption.text = element.label;
                            sourceOption.value = element.deviceId;
                            sourceSelect.appendChild(sourceOption);
                        });

                        sourceSelect.onchange = () => {
                            selectedDeviceId = sourceSelect.value;
                        };

                        const sourceSelectPanel = document.getElementById('sourceSelectPanel');
                        sourceSelectPanel.style.display = 'block';
                    }

                    document.getElementById('startButton').addEventListener('click', () => {
                        codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
                            if (result) {
                                console.log(result);
                                document.getElementById('resultCamera').textContent = result.text;
                            }
                            if (err && !(err instanceof ZXing.NotFoundException)) {
                                console.error(err);
                                document.getElementById('resultCamera').textContent = err;
                            }
                        });
                        console.log(`Started continuous decode from camera with id ${selectedDeviceId}`);
                    });

                    document.getElementById('resetButton').addEventListener('click', () => {
                        codeReader.reset();
                        document.getElementById('resultCamera').textContent = '';
                        console.log('Reset.');
                    });

                })
                .catch((err) => {
                    console.error(err);
                });
        });
    </script>
</body>
  <footer>
    https://github.com/zxing-js/library/tree/master/docs/examples/multi-image/
  </footer>
</html>
